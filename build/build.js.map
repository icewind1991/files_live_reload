{"version":3,"sources":["node_modules/browser-pack/_prelude.js","js/App.js","js/ListUpdater.js","js/Listener.js","js/LiveReload.js"],"names":[],"mappings":"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","file":"build.js","sourceRoot":"/source/","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","import {LiveReload} from './LiveReload';\n\nOC.Plugins.register('OCA.Files.FileList', {\n\tattach: (fileList) => {\n\t\tconst reloader = new LiveReload(fileList);\n\t\treloader.start();\n\t}\n});\n","export class ListUpdater {\n\tmodelCache = {};\n\n\tconstructor (fileList) {\n\t\tthis.fileList = fileList;\n\t}\n\n\tisInCurrentFolder (path) {\n\t\tconst dir = (this.fileList._currentDirectory === '/') ? '' : this.fileList._currentDirectory;\n\t\treturn OC.dirname(path) === dir;\n\t}\n\n\tgetModelForFile (path) {\n\t\tif (!this.isInCurrentFolder(path)) {\n\t\t\treturn null;\n\t\t}\n\t\tconst name = OC.basename(path);\n\t\tif (!this.modelCache[path]) {\n\t\t\tthis.modelCache[path] = this.fileList.getModelForFile(name);\n\t\t}\n\t\treturn this.modelCache[path];\n\t}\n\n\trename (from, to, data) {\n\t\tif (this.isInCurrentFolder(from) && this.isInCurrentFolder(to)) {\n\t\t\tconst model = this.getModelForFile(from);\n\t\t\tif (model) {\n\t\t\t\tmodel.set('name', OC.basename(to));\n\t\t\t}\n\t\t} else if (this.isInCurrentFolder(from)) {\n\t\t\tthis.remove(from);\n\t\t} else if (this.isInCurrentFolder(to)) {\n\t\t\tconsole.log(data);\n\t\t\tdata.path = to;\n\t\t\tthis.write(data);\n\t\t}\n\t}\n\n\twrite (data) {\n\t\tif (!this.isInCurrentFolder(data.path)) {\n\t\t\treturn null;\n\t\t}\n\t\tconsole.log('put', data);\n\t\tconst model = this.getModelForFile(data.path);\n\t\tif (model) {\n\t\t\tfor (let key in data) {\n\t\t\t\tmodel.set(key, data[key]);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.fileList.add(data);\n\t\t}\n\t}\n\n\tremove (path) {\n\t\tif (!this.isInCurrentFolder(path)) {\n\t\t\treturn null;\n\t\t}\n\t\tthis.fileList.remove(OC.basename(path));\n\t}\n}\n","export class Listener {\n\tconstructor (updater, eventSource) {\n\t\tthis.updater = updater;\n\t\tthis.eventSource = eventSource;\n\t}\n\n\tlisten () {\n\t\tthis.eventSource.addEventListener('rename', ({data}) => {\n\t\t\tconst parsed = JSON.parse(data);\n\t\t\tconst {source, target} = parsed;\n\t\t\tthis.updater.rename(source, target, parsed);\n\t\t});\n\n\t\tthis.eventSource.addEventListener('write', ({data}) => {\n\t\t\tthis.updater.write(JSON.parse(data));\n\t\t});\n\n\t\tthis.eventSource.addEventListener('delete', ({data}) => {\n\t\t\tconst {path} = JSON.parse(data);\n\t\t\tthis.updater.remove(path);\n\t\t});\n\t}\n}\n","import {ListUpdater} from './ListUpdater';\nimport {Listener} from './Listener';\n\nexport class LiveReload {\n\tsupportsEventSource () {\n\t\treturn typeof EventSource !== 'undefined';\n\t}\n\n\tconstructor (fileList) {\n\t\tthis.updater = new ListUpdater(fileList);\n\t}\n\n\tstart () {\n\t\tif (!this.supportsEventSource()) {\n\t\t\treturn;\n\t\t}\n\t\tthis.eventSource = new EventSource(OC.generateUrl('/apps/files_live_reload/listen'));\n\t\tthis.listener = new Listener(this.updater, this.eventSource);\n\t\tthis.listener.listen();\n\t}\n}\n"]}